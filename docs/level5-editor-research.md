# Level 5 Pre-Research: 웹 에디터 엔진 조사

> HanDoc Level 5 = 브라우저에서 HWPX 직접 편집
> 작성일: 2026-02-20

## 1. 에디터 엔진 비교표

| 항목 | ProseMirror | TipTap | Lexical | Slate.js | CKEditor 5 | Toast UI Editor | Quill |
|------|------------|--------|---------|----------|-------------|----------------|-------|
| **라이선스** | MIT | MIT | MIT | MIT | GPL2+ (상용 별도) | MIT | BSD-3 |
| **테이블 편집** | ✅ 플러그인 (prosemirror-tables, 매우 성숙) | ✅ (PM 테이블 래핑) | ⚠️ 플러그인 (아직 미성숙) | ⚠️ 직접 구현 필요 | ✅ 내장 (최고 수준) | ⚠️ 마크다운 테이블만 | ⚠️ 기본 없음 |
| **이미지 삽입/리사이즈** | ✅ 커스텀 노드로 구현 | ✅ 확장 제공 | ✅ 커스텀 노드 | ✅ 커스텀 엘리먼트 | ✅ 내장 (드래그 리사이즈) | ✅ 내장 | ⚠️ 제한적 |
| **커스텀 노드/마크 확장성** | ⭐⭐⭐⭐⭐ 최고 | ⭐⭐⭐⭐⭐ (PM 기반) | ⭐⭐⭐⭐ 좋음 | ⭐⭐⭐⭐ 좋음 | ⭐⭐⭐ 프레임워크 제약 | ⭐⭐ 마크다운 중심 | ⭐⭐ Blot 시스템 제한적 |
| **한글 IME** | ✅ 잘 처리 (composition 이벤트) | ✅ (PM 동일) | ✅ Meta가 i18n 신경 씀 | ⚠️ 역사적으로 IME 버그 多 | ✅ 잘 처리 | ✅ | ⚠️ IME 이슈 보고됨 |
| **협업 편집** | ✅ collab 모듈 (OT), Yjs(CRDT) 연동 | ✅ Yjs/Hocuspocus | ✅ Yjs 연동 가능 | ⚠️ 직접 구현 | ✅ 내장 (상용) | ❌ | ❌ |
| **커뮤니티/유지보수** | ⭐⭐⭐⭐⭐ 대형 (Notion, NYT, Atlassian) | ⭐⭐⭐⭐ 활발 | ⭐⭐⭐⭐ Meta 주도, 빠른 성장 | ⭐⭐ 유지보수 둔화 | ⭐⭐⭐⭐ 상업 지원 | ⭐⭐ NHN, 한국 커뮤니티 | ⭐⭐ 레거시화 |
| **문서 모델** | 트리 기반 (Block → Inline) | PM 동일 | 플랫 노드 배열 | 중첩 트리 | 트리 기반 | 마크다운 AST | Delta (선형) |
| **TypeScript** | ✅ | ✅ 네이티브 | ✅ | ✅ | ✅ | ✅ | ❌ (타입 있지만 JS) |
| **React 통합** | ⚠️ 별도 래퍼 필요 | ✅ 공식 React 패키지 | ✅ 공식 React 패키지 | ✅ React 네이티브 | ✅ React 컴포넌트 | ✅ React 래퍼 | ⚠️ 래퍼 필요 |

## 2. 상세 분석

### ProseMirror
- **핵심 강점**: 문서 스키마 시스템이 가장 강력. HWPX의 복잡한 문서 구조를 스키마로 정의 가능
- **테이블**: `prosemirror-tables`는 셀 병합, 열/행 추가삭제, 셀 선택 등 완벽 지원
- **약점**: 러닝커브 높음, 로우레벨 API (직접 빌드해야 할 것 많음)
- **채택 사례**: Notion, NYT, Atlassian Confluence, GitLab

### TipTap
- **핵심 강점**: ProseMirror 위에 DX 좋은 래퍼. 확장(Extension) 시스템으로 빠른 개발
- **테이블**: PM 테이블 그대로 사용, 추가로 편의 API 제공
- **약점**: PM 깊은 커스터마이징 시 래퍼가 오히려 방해될 수 있음
- **채택 사례**: GitLab (TipTap으로 전환), Linear

### Lexical
- **핵심 강점**: 가볍고 빠름. 접근성(a11y) 최고. Meta의 장기 투자
- **문서 모델**: ProseMirror과 다른 플랫 구조 → HWPX 매핑 시 변환 로직 필요
- **약점**: 테이블 플러그인이 아직 PM 수준에 못 미침. 생태계가 상대적으로 작음
- **채택 사례**: Meta (Facebook, Instagram Notes)

### Slate.js
- **핵심 강점**: React 네이티브, 자유로운 스키마
- **약점**: v0.x 버전으로 API 불안정 역사. IME 처리 이슈. 유지보수 둔화 추세
- **판단**: **HWPX 프로젝트에 비추천** — 리스크 대비 이점 부족

### CKEditor 5
- **핵심 강점**: 가장 완성도 높은 테이블/이미지 편집. 페이지네이션 플러그인 존재
- **약점**: GPL 라이선스 (상용 시 유료), 프레임워크가 무겁고 커스터마이징 자유도 낮음
- **판단**: 라이선스가 허용되면 가장 빠른 결과물 가능. 하지만 깊은 HWPX 커스터마이징엔 제약

### Toast UI Editor
- **핵심 강점**: 한국어 환경, NHN 지원
- **약점**: 마크다운 중심이라 리치 문서 편집(표 병합, 페이지 레이아웃)에 부적합
- **판단**: **HWPX 편집에 부적합** — 마크다운 에디터임

### Quill
- **약점**: Delta 모델이 복잡한 문서 구조에 부적합, 개발 정체, IME 이슈
- **판단**: **HWPX 편집에 부적합** — 레거시

## 3. HWPX 편집 요구사항 매핑

### 3.1 HWPX → 에디터 상태 로드
```
HWPX (XML) → 파서 → 중간 표현(IR) → 에디터 스키마 노드
```
- HWPX의 `<hp:p>`, `<hp:run>`, `<hp:tbl>` 등을 에디터 노드로 매핑
- 서식 정보(글꼴, 크기, 색상, 정렬)를 마크/어트리뷰트로 변환
- **핵심 난이도**: HWPX의 섹션/컬럼/머리글/바닥글 등 페이지 레벨 요소

### 3.2 에디터 상태 → HWPX 저장
```
에디터 노드 → 중간 표현(IR) → HWPX XML 직렬화 → ZIP 패키징
```
- 라운드트립 충실도가 핵심: 편집하지 않은 부분은 원본 유지
- **전략**: 전체 변환보다 diff 기반 패치가 현실적

### 3.3 필수 편집 기능
| 기능 | 난이도 | 비고 |
|------|--------|------|
| 문단 편집 (텍스트, 서식) | ★★☆ | 기본 에디터 기능 |
| 표 편집 (셀 병합 포함) | ★★★ | PM 테이블이 가장 적합 |
| 이미지 삽입/리사이즈 | ★★☆ | 커스텀 노드 필요 |
| 글머리 기호/번호 | ★★☆ | 기본 에디터 기능 |
| 페이지 레이아웃 표시 | ★★★★★ | 가장 어려움, 선택적 |

### 3.4 페이지 레이아웃 (선택적)
- CSS `@page` + 고정 높이 컨테이너로 시뮬레이션 가능
- 실제 페이지 나눔(pagination)은 극히 어려움 → Phase 2로
- CKEditor 5의 Pagination 플러그인이 유일한 기성 솔루션 (상용)

## 4. 추천: ProseMirror (또는 TipTap)

### 왜 ProseMirror인가?

1. **스키마 시스템**: HWPX 문서 구조를 정밀하게 모델링 가능
2. **테이블**: `prosemirror-tables`가 셀 병합 포함 최고 수준
3. **확장성**: 커스텀 노드(각주, 미주, 필드코드 등) 자유롭게 정의
4. **한글 IME**: composition 이벤트 안정적 처리
5. **협업**: Yjs 연동으로 CRDT 기반 실시간 편집 가능
6. **생태계**: 가장 큰 커뮤니티, 레퍼런스 풍부
7. **라이선스**: MIT — 상용 제약 없음

### TipTap vs 순수 ProseMirror?

| | ProseMirror 직접 | TipTap |
|---|---|---|
| 초기 개발 속도 | 느림 | 빠름 |
| 깊은 커스터마이징 | 자유로움 | PM으로 내려가야 할 때 있음 |
| HWPX 특수 요구 | 직접 제어 가능 | 래퍼 레이어가 방해 가능 |

**추천**: HWPX는 일반 에디터가 아니므로 **ProseMirror 직접 사용** 추천.
TipTap의 DX 이점보다 깊은 제어가 더 중요.

### 통합 전략

```
Phase 1: 읽기 전용 뷰어 (현재 Level 2-3)
  └─ HWPX → HTML 렌더링

Phase 2: 기본 편집 (Level 5 시작)
  ├─ ProseMirror 스키마 정의 (HWPX 구조 매핑)
  ├─ HWPX → PM Doc 변환기
  ├─ PM Doc → HWPX 직렬화기
  ├─ 문단/인라인 서식 편집
  └─ 테이블 기본 편집

Phase 3: 고급 편집
  ├─ 이미지 삽입/리사이즈
  ├─ 셀 병합/분할
  ├─ 머리글/바닥글
  └─ 스타일(CharPr/ParaPr) 완전 지원

Phase 4: 페이지 레이아웃 (선택)
  ├─ CSS 기반 페이지 시뮬레이션
  ├─ 페이지 나눔 프리뷰
  └─ 인쇄 미리보기
```

### 아키텍처

```
┌─────────────────────────────────────────┐
│              Web Editor UI              │
│  ┌──────────────────────────────────┐   │
│  │        ProseMirror Editor        │   │
│  │  (커스텀 스키마 + 플러그인)       │   │
│  └──────────┬───────────────────────┘   │
│             │                           │
│  ┌──────────▼───────────────────────┐   │
│  │     HWPX ↔ PM 변환 레이어       │   │
│  │  - hwpx-to-pmdoc (로드)          │   │
│  │  - pmdoc-to-hwpx (저장)          │   │
│  │  - 라운드트립 충실도 보장         │   │
│  └──────────┬───────────────────────┘   │
│             │                           │
│  ┌──────────▼───────────────────────┐   │
│  │    HanDoc Core (기존 파서)       │   │
│  │  - HWPX 파싱/직렬화              │   │
│  │  - 바이너리 리소스 관리           │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

## 5. 리스크 및 완화

| 리스크 | 영향 | 완화 |
|--------|------|------|
| HWPX 라운드트립 손실 | 높음 | 원본 XML 보존, diff 패치 방식 |
| PM 스키마와 HWPX 구조 불일치 | 중간 | 중간 표현(IR) 레이어로 분리 |
| 페이지 레이아웃 구현 난이도 | 높음 | Phase 4로 후순위, CSS 시뮬레이션 |
| 복잡한 표(병합) 라운드트립 | 중간 | prosemirror-tables 활용, 테스트 케이스 |

## 6. 결론

**ProseMirror 직접 사용**이 HWPX 웹 편집기의 최적 선택.

- MIT 라이선스, 최고의 확장성, 성숙한 테이블 지원
- HWPX 특수 구조를 스키마로 정밀 모델링 가능
- 기존 HanDoc 파서와 변환 레이어로 연결
- Level 2-3의 뷰어 → Level 5의 편집기로 자연스러운 진화 경로
